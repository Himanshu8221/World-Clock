<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Time Clock | ðŸ‡®ðŸ‡³</title>
    <link rel="icon" href="https://www.google.com/favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease; /* Smooth transition for theme change */
        }
        .animate-pulse-slow {
            animation: pulse-slow 5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: .7; }
        }

        /* Light Mode Styles */
        body.light-mode {
            background-color: #f3f4f6; /* bg-gray-100 */
            color: #1f2937; /* text-gray-800 */
        }

        body.light-mode .text-white { color: #1f2937; } /* Override specific text-white elements */
        body.light-mode .text-gray-400 { color: #4b5563; } /* Override specific text-gray-400 */
        body.light-mode .text-gray-800 { color: #374151; }
        body.light-mode .text-gray-950 { background-color: #f3f4f6; } /* Body background */
        body.light-mode .bg-gray-900 { background-color: #ffffff; border-color: #e5e7eb; } /* Main card background */
        body.light-mode .bg-gray-800 { background-color: #f9fafb; border-color: #e5e7eb; } /* Smaller card background */
        body.light-mode .border-gray-800 { border-color: #e5e7eb; }
        body.light-mode .border-gray-700 { border-color: #e5e7eb; }
        body.light-mode .placeholder-gray-400 { color: #9ca3af; }
        body.light-mode .text-emerald-400 { color: #059669; } /* Darker emerald for contrast */
        body.light-mode .text-cyan-400 { color: #06b6d4; } /* Darker cyan for contrast */
        body.light-mode .text-blue-400 { color: #2563eb; } /* Darker blue for contrast */
        body.light-mode .from-emerald-400 { --tw-gradient-from: #10b981; } /* Header gradient */
        body.light-mode .via-cyan-400 { --tw-gradient-via: #0ea5e9; }
        body.light-mode .to-blue-500 { --tw-gradient-to: #3b82f6; }
    </style>
</head>
<body class="bg-gray-950 text-white min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-5xl mx-auto space-y-12">
        
        <header class="text-center relative">
            <h1 class="text-5xl md:text-6xl lg:text-7xl font-extrabold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 via-cyan-400 to-blue-500 animate-pulse-slow">
                World Time
            </h1>
            <p class="mt-4 text-xl md:text-2xl text-gray-400">Live, Accurate, and Beautiful. âœ¨</p>

            <button id="theme-toggle" class="absolute top-0 right-0 p-3 rounded-full bg-gray-800 text-gray-300 hover:bg-gray-700 hover:text-white transition-colors">
                <span id="theme-icon">ðŸ’¡</span>
            </button>
        </header>

        <div id="india-clock-section" class="bg-gray-900 p-8 md:p-12 rounded-3xl shadow-2xl border border-gray-800 transition-transform duration-300 hover:scale-[1.01]">
            <h2 class="text-2xl md:text-3xl font-bold text-center text-emerald-400 mb-4">India (IST) ðŸ‡®ðŸ‡³</h2>
            <div id="india-time" class="text-6xl md:text-8xl lg:text-9xl font-light text-center tracking-tight text-white transition-opacity duration-500 ease-in-out">
                </div>
            <div id="india-date" class="text-lg md:text-xl text-center text-gray-400 mt-2">
                </div>
            <div class="flex justify-center space-x-4 mt-6">
                <button id="india-toggle-12hr" class="px-5 py-2 rounded-full bg-emerald-600 hover:bg-emerald-700 transition-colors font-semibold text-sm">12 Hour</button>
                <button id="india-toggle-24hr" class="px-5 py-2 rounded-full bg-cyan-600 hover:bg-cyan-700 transition-colors font-semibold text-sm">24 Hour</button>
            </div>
        </div>

        <div id="all-timezones-section" class="space-y-6">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-cyan-400">All Timezones</h2>
                <p class="text-gray-400 mt-2">Search for a city or country to see its local time.</p>
            </div>
            <input type="text" id="search-input" placeholder="Search for a city or timezone..." class="w-full p-4 rounded-full bg-gray-800 border border-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500">
            
            <div id="loading-indicator" class="text-center text-gray-400 mt-4">
                Loading all timezones...
            </div>

            <div id="all-clocks-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
        </div>

        <div id="big-clock-display" class="hidden bg-gray-900 p-8 md:p-12 rounded-3xl shadow-2xl border border-gray-800 text-center">
            <button id="back-button" class="block w-fit mx-auto text-gray-400 hover:text-white text-lg px-3 py-1 rounded-full border border-gray-700 hover:border-white transition-colors mb-6 md:mb-4">
                &larr; Back to All
            </button>
            <h2 id="big-clock-city-name" class="text-3xl md:text-4xl font-bold text-blue-400 mb-2"></h2>
            <p id="big-clock-timezone-name" class="text-lg text-gray-400 mb-4"></p>
            <div id="big-clock-time" class="text-7xl md:text-8xl lg:text-9xl font-light text-white mb-4"></div>
            <div id="big-clock-date" class="text-xl md:text-2xl text-gray-400 mb-6"></div>

            <div class="flex justify-center space-x-4">
                <button id="toggle-12hr" class="px-6 py-3 rounded-full bg-emerald-600 hover:bg-emerald-700 transition-colors font-semibold">12 Hour</button>
                <button id="toggle-24hr" class="px-6 py-3 rounded-full bg-cyan-600 hover:bg-cyan-700 transition-colors font-semibold">24 Hour</button>
            </div>
        </div>

    </div>

    <template id="clock-card-template">
        <div class="bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700 transition-transform duration-300 hover:scale-105 hover:shadow-2xl cursor-pointer">
            <h3 class="text-xl font-bold text-white mb-1" data-id="city-name"></h3>
            <p class="text-sm text-gray-400 mb-2" data-id="timezone-name"></p>
            <div class="text-3xl font-semibold text-cyan-400" data-id="current-time"></div>
            <div class="text-sm font-medium text-gray-400 mt-1" data-id="time-diff"></div>
        </div>
    </template>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const indiaTimezone = 'Asia/Kolkata';
            const indiaClockSection = document.getElementById('india-clock-section');
            const allTimezonesSection = document.getElementById('all-timezones-section');
            const allClocksContainer = document.getElementById('all-clocks-container');
            const searchInput = document.getElementById('search-input');
            const loadingIndicator = document.getElementById('loading-indicator');
            const clockTemplate = document.getElementById('clock-card-template');

            // India clock elements
            const indiaTimeElement = document.getElementById('india-time');
            const indiaDateElement = document.getElementById('india-date');
            const indiaToggle12hrButton = document.getElementById('india-toggle-12hr');
            const indiaToggle24hrButton = document.getElementById('india-toggle-24hr');

            // Big clock display elements
            const bigClockDisplay = document.getElementById('big-clock-display');
            const bigClockCityName = document.getElementById('big-clock-city-name');
            const bigClockTimezoneName = document.getElementById('big-clock-timezone-name');
            const bigClockTime = document.getElementById('big-clock-time');
            const bigClockDate = document.getElementById('big-clock-date');
            const toggle12hrButton = document.getElementById('toggle-12hr');
            const toggle24hrButton = document.getElementById('toggle-24hr');
            const backButton = document.getElementById('back-button');

            // Theme toggle elements
            const themeToggleButton = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');

            let currentBigClockTimezone = ''; 
            let isBigClock12HourFormat = true; // Format for the big clock display
            let isIndiaClock12HourFormat = true; // Format for the India clock
            let isDarkMode = true; // Initial theme state

            // List of all available timezones
            const allTimezones = Intl.supportedValuesOf('timeZone');
            let displayedTimezones = [];
            
            // Map to store pre-parsed timezone display names for faster rendering
            const timezoneDisplayNames = new Map();

            /**
             * Extracts a more user-friendly city/country name from a timezone string.
             * @param {string} timezone The IANA timezone string.
             * @returns {string} A user-friendly name.
             */
            function getFriendlyTimezoneName(timezone) {
                if (timezoneDisplayNames.has(timezone)) {
                    return timezoneDisplayNames.get(timezone);
                }

                try {
                    const parts = timezone.split('/');
                    let countryOrRegion = '';
                    let cityOrArea = '';

                    if (parts.length === 1) {
                        countryOrRegion = parts[0].replace(/_/g, ' ');
                    } else if (parts.length === 2) {
                        countryOrRegion = parts[0].replace(/_/g, ' ');
                        cityOrArea = parts[1].replace(/_/g, ' ');
                    } else if (parts.length >= 3) {
                        countryOrRegion = parts[1].replace(/_/g, ' ');
                        cityOrArea = parts.slice(2).join(' ').replace(/_/g, ' ');
                    }

                    let formattedName = new Intl.DateTimeFormat('en-US', {
                        timeZone: timezone,
                        timeZoneName: 'longGeneric'
                    }).format(new Date());

                    if (formattedName && formattedName.length < 30 && !formattedName.includes('GMT')) {
                        formattedName = formattedName.replace(/Standard Time|Daylight Time|Time/gi, '').trim();
                        if (formattedName && formattedName.toLowerCase() !== countryOrRegion.toLowerCase() && formattedName.toLowerCase() !== cityOrArea.toLowerCase()) {
                            if (cityOrArea) {
                                const finalName = `${countryOrRegion} (${cityOrArea})`;
                                timezoneDisplayNames.set(timezone, finalName);
                                return finalName;
                            }
                            timezoneDisplayNames.set(timezone, formattedName);
                            return formattedName;
                        }
                    }

                    if (cityOrArea) {
                        const regionMap = {
                            'America': 'United States', 
                            'Europe': 'Europe',
                            'Asia': 'Asia',
                            'Africa': 'Africa',
                            'Australia': 'Australia',
                            'Pacific': 'Pacific Islands',
                            'Atlantic': 'Atlantic Islands',
                            'Indian': 'Indian Ocean',
                            'Arctic': 'Arctic'
                        };
                        const displayRegion = regionMap[parts[0]] || parts[0].replace(/_/g, ' ');
                        
                        let finalName = `${displayRegion}`;
                        if (cityOrArea) {
                            finalName += ` (${cityOrArea})`;
                        }
                        timezoneDisplayNames.set(timezone, finalName);
                        return finalName;
                    }
                    timezoneDisplayNames.set(timezone, countryOrRegion || timezone.replace(/_/g, ' '));
                    return countryOrRegion || timezone.replace(/_/g, ' ');

                } catch (e) {
                    console.error(`Error getting friendly name for ${timezone}:`, e);
                    timezoneDisplayNames.set(timezone, timezone.replace(/_/g, ' '));
                    return timezone.replace(/_/g, ' ');
                }
            }


            /**
             * Updates the time and date for the main India clock.
             */
            function updateIndiaClock() {
                const now = new Date();
                const timeOptions = { timeZone: indiaTimezone, hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: isIndiaClock12HourFormat };
                const dateOptions = { timeZone: indiaTimezone, weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                
                indiaTimeElement.innerText = new Intl.DateTimeFormat('en-US', timeOptions).format(now);
                indiaDateElement.innerText = new Intl.DateTimeFormat('en-US', dateOptions).format(now);
            }

            /**
             * Updates the time for a single clock card.
             * @param {HTMLElement} card The clock card element.
             * @param {string} timezone The timezone string for the card.
             */
            function updateSingleClock(card, timezone) {
                const now = new Date();
                const timeOptions = { timeZone: timezone, hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true }; // Small cards always 12hr
                const timeString = new Intl.DateTimeFormat('en-US', timeOptions).format(now);
                
                card.querySelector('[data-id="current-time"]').innerText = timeString;

                const nowIndia = new Date(now.toLocaleString('en-US', { timeZone: indiaTimezone }));
                const nowCity = new Date(now.toLocaleString('en-US', { timeZone: timezone }));
                
                const diffMs = nowCity - nowIndia;
                const totalMinutes = Math.round(diffMs / (1000 * 60));
                const diffHours = Math.floor(Math.abs(totalMinutes) / 60);
                const diffMinutes = Math.abs(totalMinutes) % 60;

                let sign = (totalMinutes >= 0) ? '+' : '-';
                if (totalMinutes === 0) {
                    sign = '';
                }

                const diffString = `${sign}${diffHours.toString().padStart(2, '0')}:${diffMinutes.toString().padStart(2, '0')}`;
                const timeDiffElement = card.querySelector('[data-id="time-diff"]');
                if (timeDiffElement) {
                    timeDiffElement.innerText = `Difference from IST: ${diffString}`;
                }
            }
            
            /**
             * Renders a list of clock cards for the given timezones.
             * @param {string[]} timezonesToDisplay The list of timezones to render.
             */
            function renderClocks(timezonesToDisplay) {
                allClocksContainer.innerHTML = '';
                
                if (timezonesToDisplay.length === 0) {
                    allClocksContainer.innerHTML = '<p class="text-center text-gray-400">No matching timezones found.</p>';
                    return;
                }

                timezonesToDisplay.sort((a, b) => {
                    const nameA = getFriendlyTimezoneName(a);
                    const nameB = getFriendlyTimezoneName(b);
                    return nameA.localeCompare(nameB);
                });

                timezonesToDisplay.forEach(timezone => {
                    const newCard = clockTemplate.content.cloneNode(true);
                    
                    const friendlyName = getFriendlyTimezoneName(timezone);

                    const cityNameElement = newCard.querySelector('[data-id="city-name"]');
                    const timezoneNameElement = newCard.querySelector('[data-id="timezone-name"]');

                    cityNameElement.innerText = friendlyName;
                    timezoneNameElement.innerText = timezone;

                    const cardElement = newCard.querySelector('.bg-gray-800');
                    updateSingleClock(cardElement, timezone);
                    
                    cardElement.addEventListener('click', () => openBigClock(timezone));

                    allClocksContainer.appendChild(newCard);
                });
            }

            /**
             * Updates all visible clocks.
             */
            function updateAllClocks() {
                if (!indiaClockSection.classList.contains('hidden')) {
                    updateIndiaClock();
                }
                
                if (!allTimezonesSection.classList.contains('hidden')) {
                    const cards = allClocksContainer.querySelectorAll('.bg-gray-800');
                    cards.forEach(card => {
                        const timezone = card.querySelector('[data-id="timezone-name"]').innerText;
                        updateSingleClock(card, timezone);
                    });
                }

                if (!bigClockDisplay.classList.contains('hidden')) {
                    updateBigClock();
                }
            }

            // --- BIG CLOCK DISPLAY FUNCTIONS ---
            function updateBigClock() {
                if (!currentBigClockTimezone) return; 

                const now = new Date();
                const timeOptions = { 
                    timeZone: currentBigClockTimezone, 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit', 
                    hour12: isBigClock12HourFormat 
                };
                const dateOptions = { 
                    timeZone: currentBigClockTimezone, 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                };
                
                bigClockTime.innerText = new Intl.DateTimeFormat('en-US', timeOptions).format(now);
                bigClockDate.innerText = new Intl.DateTimeFormat('en-US', dateOptions).format(now);
            }

            function openBigClock(timezone) {
                currentBigClockTimezone = timezone;
                bigClockCityName.innerText = getFriendlyTimezoneName(timezone);
                bigClockTimezoneName.innerText = timezone;
                
                updateBigClock(); 

                indiaClockSection.classList.add('hidden');
                allTimezonesSection.classList.add('hidden');
                
                bigClockDisplay.classList.remove('hidden');
            }

            function showAllClocks() {
                bigClockDisplay.classList.add('hidden');
                currentBigClockTimezone = ''; 

                indiaClockSection.classList.remove('hidden');
                allTimezonesSection.classList.remove('hidden');
            }

            function toggleBigClockTimeFormat(is12Hour) {
                isBigClock12HourFormat = is12Hour;
                if (is12Hour) {
                    toggle12hrButton.classList.add('bg-emerald-700');
                    toggle12hrButton.classList.remove('bg-emerald-600');
                    toggle24hrButton.classList.add('bg-cyan-600');
                    toggle24hrButton.classList.remove('bg-cyan-700');
                } else {
                    toggle12hrButton.classList.add('bg-emerald-600');
                    toggle12hrButton.classList.remove('bg-emerald-700');
                    toggle24hrButton.classList.add('bg-cyan-700');
                    toggle24hrButton.classList.remove('bg-cyan-600');
                }
                updateBigClock();
            }

            // --- INDIA CLOCK FORMAT FUNCTIONS ---
            function toggleIndiaClockTimeFormat(is12Hour) {
                isIndiaClock12HourFormat = is12Hour;
                if (is12Hour) {
                    indiaToggle12hrButton.classList.add('bg-emerald-700');
                    indiaToggle12hrButton.classList.remove('bg-emerald-600');
                    indiaToggle24hrButton.classList.add('bg-cyan-600');
                    indiaToggle24hrButton.classList.remove('bg-cyan-700');
                } else {
                    indiaToggle12hrButton.classList.add('bg-emerald-600');
                    indiaToggle12hrButton.classList.remove('bg-emerald-700');
                    indiaToggle24hrButton.classList.add('bg-cyan-700');
                    indiaToggle24hrButton.classList.remove('bg-cyan-600');
                }
                updateIndiaClock();
            }

            // --- THEME TOGGLE FUNCTIONS ---
            function toggleTheme() {
                isDarkMode = !isDarkMode;
                if (isDarkMode) {
                    document.body.classList.remove('light-mode');
                    themeIcon.innerText = 'ðŸ’¡'; // Lightbulb for dark mode
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.body.classList.add('light-mode');
                    themeIcon.innerText = 'ðŸŒ™'; // Moon for light mode
                    localStorage.setItem('theme', 'light');
                }
            }

            // --- EVENT LISTENERS ---
            searchInput.addEventListener('input', (event) => {
                const searchTerm = event.target.value.toLowerCase();
                displayedTimezones = allTimezones.filter(tz => {
                    const friendlyName = getFriendlyTimezoneName(tz).toLowerCase();
                    return tz.toLowerCase().includes(searchTerm) || friendlyName.includes(searchTerm);
                });
                renderClocks(displayedTimezones);
            });
            
            toggle12hrButton.addEventListener('click', () => toggleBigClockTimeFormat(true));
            toggle24hrButton.addEventListener('click', () => toggleBigClockTimeFormat(false));

            indiaToggle12hrButton.addEventListener('click', () => toggleIndiaClockTimeFormat(true));
            indiaToggle24hrButton.addEventListener('click', () => toggleIndiaClockTimeFormat(false));

            backButton.addEventListener('click', showAllClocks);

            themeToggleButton.addEventListener('click', toggleTheme);

            // --- INITIAL SETUP ---
            // Load theme preference from local storage
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                isDarkMode = false; // Set to light mode
                document.body.classList.add('light-mode');
                themeIcon.innerText = 'ðŸŒ™';
            } else {
                isDarkMode = true; // Default to dark mode or saved dark mode
                document.body.classList.remove('light-mode');
                themeIcon.innerText = 'ðŸ’¡';
            }

            loadingIndicator.style.display = 'block';
            allTimezones.forEach(tz => getFriendlyTimezoneName(tz)); // Pre-populate cache
            renderClocks(allTimezones); 
            loadingIndicator.style.display = 'none';

            // Set initial button states
            toggleBigClockTimeFormat(true); // Default big clock to 12hr
            toggleIndiaClockTimeFormat(true); // Default India clock to 12hr

            setInterval(updateAllClocks, 1000);
        });
    </script>
</body>
</html>
